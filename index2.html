<!DOCTYPE html>
<meta charset="utf-8">
<style> /* set the CSS */

body { font: 12px sans-serif;}

path { 
    stroke: green;
    stroke-width: 1;
    fill: none;
}


.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}

.legend {
  font-size: 16px;
  font-weight: bold;
  text_anchor: middle;}

.axis-label {
  font-size: 16px;
  font-weight: bold;}

.area {
    fill: lightsteelblue;
    stroke-width: 0;}

.brush .extent {
  stroke: #fff;
  fill-opacity: .125;
  shape-rendering: crispEdges;}


</style>

<body>

<!-- load the d3.js library -->    
<script src="http://d3js.org/d3.v3.min.js"></script>

<script>


function draw(data) {

        var margin = 75,
              width = 900 - margin,
              height = 500 - margin;


        var svg = d3.select("body")
              .append("svg")
              .attr("width", width + margin)
              .attr("height", height + margin)
              .append('g')
              .attr('class', 'chart');


  // Create the axis
        var time_extent = d3.extent(data, function(d) {
              return d['date'];
          });

        var x = d3.time.scale()
              .range([margin, width]);

        var time_scale = x.domain(time_extent);

        var time_axis = d3.svg.axis()
              .scale(time_scale)
              .ticks(6);

        
        var price_extent = [0, d3.max(data, function(d) { return d.close; })];

        var y = d3.scale.linear()
              .range([height, margin]);

        var price_scale = y.domain(price_extent);

        var price_axis = d3.svg.axis()
              .scale(price_scale)
              .orient("left")
              .ticks(10);

  // Create area    

        var area = d3.svg.area()
            .x(function(d) { return x(d.date); })
            .y0(height)
            .y1(function(d) { return y(d.close); });


  // Define the line
        var stockline = d3.svg.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.close); });


  // Nest data by symbol
        var NestData = d3.nest()
              .key(function (d) { return d.symbol;})
              .entries(data);
        
        //debugger;

  // Add the stockline path, add color, add legend

        legendSpace = width/NestData.length;

        NestData.forEach(function (d,i) {

            svg.append("path")
            .attr("class", "line")
            .attr("d", stockline(d.values))
            .style("stroke", function () { if (d.key === "TSLA") {  //add color
                                              d.color = "red";}
                                          else {d.color = "green";}
                                          return d.color;})
            svg.append("text")                                    //add legend
            .attr("x", width+20) // spacing // ****
            .attr("y",  (i*30+200))         
            .attr("class", "legend")    // style the legend   
            .style("fill", function () { if (d.key === "TSLA") {  
                                              d.color = "red";}
                                          else {d.color = "green";}
                                          return d.color;})
            .text(d.key);                                     
        });


  // Add the axis
        d3.select("svg")
              .append('g')
                .attr('class', 'x axis')
                .attr('transform', "translate(0," + height + ")")
                .call(time_axis)
              .append("text")
                .attr("class","axis-label")
                .attr("y", 50)
                .attr("x", width/2)
                .text("Time");


        d3.select("svg")
              .append('g')
                  .attr('class', 'y axis')
                  .attr('transform', "translate(" + margin + ",0)")
                  .call(price_axis)
              .append("text") // Add axis title
                  .attr("class", "axis-label")
                  .attr("transform", "rotate(-90)")
                  .attr("y", -margin + 20)
                  .attr("x", (-height-100)/2)
                  .text('Stock Price');
             
  


  
  // Draw points for each data

  /*svg.append("clipPath")
  .attr("id", "clip")
  .append("rect")
  .attr("width", width)
  .attr("height", height);

  
  var points = svg.selectAll('.dots')
  .data(data)
  .enter()
  .append("g")
    .attr("class", "dots")
  .attr("clip-path", "url(#clip)"); 

  

points.selectAll('.dot')
  .data(data)
  .enter()
  .append('circle')
  .attr('class','dot')
  .attr("r", 0)
   
  .attr("transform", function(d) { 
    return "translate(" + x(d.point.x) + "," + y(d.point.y) + ")"; }
  );

  debugger;*/


  // Zoom effect
 
    /* var zoom = d3.behavior.zoom()
      .x(time_scale)
      .y(price_scale)
      .scaleExtent([1, 10])
      .on("zoom", zoomed);  


    function zoomed() {
      svg.select(".x.axis").call(time_axis);
      svg.select(".y.axis").call(price_axis);   
      svg.selectAll('path.line').attr('d', line);  
 
      points.selectAll('circle').attr("transform", function(d) { 
    return "translate(" + x(d.point.x) + "," + y(d.point.y) + ")"; }
  );  
}*/
    
};   

// Get the data
var parseDate = d3.time.format("%m/%d/%Y"); 

d3.csv("HistoricalQuotes_both.csv", function(d) {
        d['close'] = +d['close'];
        d['date'] = parseDate.parse(d['date']);
        return d;
      }, draw); 


</script>
</body>

</html>